/** 
* @name Hermit
* @version 1.9
* @create 2014-02-07
* @lastmodified 2015-02-12 13:38
* @description Hermit Plugin
* @author MuFeng (http://mufeng.me)
* @url http://mufeng.me/hermit-for-wordpress.html
**/
jQuery(document).ready(function(a){function b(b,f){if(p.array="","xiami"==b)switch(p.type){case"songlist":if((f=f.match(/song\/(\d+)/gi))&&f.length>0){var g=[];a.each(f,function(b,c){-1===a.inArray(c,g)&&g.push(c)}),p.array=g.join(",").replace(/song\//g,"")}break;case"album":(f=f.match(/album\/(\d+)/gi))&&f.length>0&&(p.array=f[0].replace(/album\//g,""));break;case"collect":(f=f.match(/collect\/(\d+)/gi))&&f.length>0&&(p.array=f[0].replace(/collect\//g,""))}if("netease"==b)switch(p.type){case"netease_songs":if((f=f.match(/song\?id=(\d+)/gi))&&f.length>0){var g=[];a.each(f,function(b,c){-1===a.inArray(c,g)&&g.push(c)}),p.array=g.join(",").replace(/song\?id=/g,"")}break;case"netease_album":(f=f.match(/album\?id=(\d+)/gi))&&f.length>0&&(p.array=f[0].replace(/album\?id=/g,""));break;case"netease_playlist":(f=f.match(/playlist\?id=(\d+)/gi))&&f.length>0&&(p.array=f[0].replace(/playlist\?id=/g,""))}"remote"==b&&(p.type="remote",p.array=f),p.array?d():c(),e(b,p)}function c(){a("#hermit-shell-insert").attr("disabled","disabled")}function d(){a("#hermit-shell-insert").removeAttr("disabled")}function e(b,c){h='[hermit auto="'+c.auto+'" loop="'+c.loop+'" unexpand="'+c.unexpand+'"]'+c.type+"#:"+c.array+"[/hermit]",a("#hermit-preview").text(h).addClass("texted")}function f(){g="xiami",p={type:"",array:"",auto:0,loop:0,unexpand:0},h="",k.append(m())}var g,h,i,j=a("#gohermit"),k=a("body"),l=a("#hermit-template").html(),m=Handlebars.compile(l),n=a("#hermit-remote-template").html(),o=Handlebars.compile(n),p={type:"",array:"",auto:0,loop:0,unexpand:0},q=1;j.click(function(){f()}),k.on("click","#hermit-shell-close",function(){a("#hermit-shell").remove()}),k.on("click","#hermit-shell-insert",function(){var b=a(this);"disabled"!=b.attr("disabled")&&(send_to_editor(h),a("#hermit-shell").remove())}),k.on("click","#hermit-remote-content ul li",function(){var b=a(this);b.hasClass("selected")?b.removeClass("selected"):b.addClass("selected")}),k.on("click",".media-router a",function(){var b=a(this),c=a(".media-router a").index(b);b.hasClass("active")||(a(".media-router a.active,.hermit-li.active").removeClass("active"),b.addClass("active"),a(".hermit-li").eq(c).addClass("active"),g=a(".hermit-li").eq(c).attr("data-type"),"remote"==g&&(i?a("#hermit-remote-content ul").html(o(i)):a.ajax({url:hermit.ajax_url,data:{action:"hermit_source",type:"index",paged:q},success:function(b){i=b,a("#hermit-remote-content ul").html(o(i)),q++},error:function(){alert("获取失败, 请稍候重试")}})))}),k.on("click","#hermit-auto",function(){var b=a(this);p.auto=b.prop("checked")?1:0,e(g,p)}),k.on("click","#hermit-loop",function(){var b=a(this);p.loop=b.prop("checked")?1:0,e(g,p)}),k.on("change","#hermit-unexpand",function(){var b=a(this);p.unexpand=b.prop("checked")?1:0,e(g,p)}),k.on("click","#hermit-remote-sure",function(){var c=[];a("#hermit-remote-content ul li.selected").each(function(){c.push(a(this).attr("data-id"))}),c=c.join(","),console.log(g),b(g,c)}),k.on("change",".hermit-li.active input",function(){var c=a(".hermit-li.active .hermit-textarea").val();p.type=a(".hermit-li.active input:checked").val(),b(g,c)}),k.on("focus keyup input paste",".hermit-textarea",function(){var c=a(this),d=c.val();p.type=a(".hermit-li.active input:checked").val(),b(g,d)})});