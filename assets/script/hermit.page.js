/** 
* @name Hermit
* @version 1.8.1
* @create 2014-02-07
* @lastmodified 2015-01-14 18:59
* @description Hermit Plugin
* @author MuFeng (http://mufeng.me)
* @url http://mufeng.me/hermit-for-wordpress.html
**/
"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx,escapable,gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(a){a(document).ready(function(){function b(){var b=[];return a(".hermit-music-checkbox").each(function(){var c=a(this);c.prop("checked")&&b.push(c.val())}),b}function c(){a(".hermit-music-checkbox").prop("checked",!0)}function d(){a(".hermit-music-checkbox").prop("checked",!1)}function e(b){u||a.ajax({url:hermit.ajax_url,data:{action:"hermit_source",type:"delete",ids:b.join(",")},type:"post",beforeSend:function(){u=!0,t.text("删除歌曲中。。。").removeAttr("class").addClass("hermit-new-form-tips").show()},success:function(a){u=!1,200==a.msg&&(h(),t.text("删除成功").removeAttr("class").addClass("hermit-new-form-tips success").show())},error:function(){u=!1,t.text("删除失败, 请稍候重试").removeAttr("class").addClass("hermit-new-form-tips err").show()}})}function f(b,c){u||a.ajax({url:hermit.ajax_url,data:"action=hermit_source&type=new&"+b,type:"post",beforeSend:function(){u=!0},success:function(a){u=!1,c.remove(),200==a.msg&&h()},error:function(){u=!1,t.text("新建失败, 请稍候重试").removeAttr("class").addClass("hermit-new-form-tips err").show()}})}function g(b,c){u||a.ajax({url:hermit.ajax_url,data:"action=hermit_source&type=update&"+b,type:"post",beforeSend:function(){u=!0},success:function(a){u=!1,c.parent().children("ul").show(),c.remove(),200==a.msg&&h()},error:function(){u=!1,t.text("新建失败, 请稍候重试").removeAttr("class").addClass("hermit-new-form-tips err").show()}})}function h(){u||a.ajax({url:hermit.ajax_url,data:{action:"hermit_source",type:"list"},type:"post",beforeSend:function(){u=!0,a(".hermit-music-body").addClass("unload")},success:function(b){n.html(k(b)),u=!1,a(".hermit-music-body").removeClass("unload")},error:function(){u=!1,a(".hermit-music-body").removeClass("unload"),t.text("获取失败, 请稍候重试").removeAttr("class").addClass("hermit-new-form-tips err").show()}})}function i(b){b=b.split("&");var c={};return a.each(b,function(b,d){d=d.split("="),c[d[0]]=a.trim(d[1])}),c}var j=a("#hermit-music-template").html(),k=Handlebars.compile(j),l=a("#hermit-new-template").html(),m=Handlebars.compile(l),n=a(".hermit-music-body-form").first(),o=(a("#hermit-music-new-form"),a("#hermit-music-checkall")),p=a("#hermit-music-new"),q=a(".wrap").first(),r=a(".hermit-music-header").first(),s=a("#hermit-music-delete"),t=a(".hermit-music-delete-tips").first(),u=!1;Handlebars.registerHelper("json",function(a){return JSON.stringify(a)}),a("#set-group").click(function(){var b=a(this),c=b.parent();c.hasClass("open")?c.removeClass("open"):c.addClass("open")}),h(),s.click(function(){var c=b();c.length<1?t.text("尚未选中任何项目").removeAttr("class").addClass("hermit-new-form-tips err").show():e(c),a("#set-group").parent().removeClass("open")}),o.click(function(){var b=a(this),e=b.prop("checked");e?c():d()}),q.on("click",".hermit-new-form-sure",function(){var b=a(this),c=b.closest(".hermit-music-new-form");$tips=c.children(".hermit-new-form-tips").first(),query=c.serialize(),_query=i(query),_query.song_name?_query.song_author?_query.song_url?(f(query,c),$tips.text("正在提交数据。。。").removeAttr("class").addClass("hermit-new-form-tips loading").show()):$tips.text("尚未输入音乐地址").removeAttr("class").addClass("hermit-new-form-tips err").show():$tips.text("尚未输入歌手作者").removeAttr("class").addClass("hermit-new-form-tips err").show():$tips.text("尚未输入歌曲名称").removeAttr("class").addClass("hermit-new-form-tips err").show()}),q.on("click",".hermit-new-form-edit",function(){var b=a(this),c=b.closest(".hermit-music-new-form");$tips=c.children(".hermit-new-form-tips").first(),query=c.serialize(),_query=i(query),_query.song_name?_query.song_author?_query.song_url?(g(query,c),$tips.text("正在提交数据。。。").removeAttr("class").addClass("hermit-new-form-tips loading").show()):$tips.text("尚未输入音乐地址").removeAttr("class").addClass("hermit-new-form-tips err").show():$tips.text("尚未输入歌手作者").removeAttr("class").addClass("hermit-new-form-tips err").show():$tips.text("尚未输入歌曲名称").removeAttr("class").addClass("hermit-new-form-tips err").show()}),q.on("click",".hermit-new-form-cancel",function(){var b=a(this),c=b.closest(".hermit-music-new-form");c.prev("ul").length>0&&c.prev("ul").show(),c.remove()}),q.on("click",".hermit-music-edit",function(){var b=a(this),c=b.closest(".hermit-music-li"),d=c.children("ul"),e=JSON.parse(b.attr("data-json"));d.hide(),c.append(m(e))}),p.click(function(){r.append(m({song_name:"",song_author:"",song_url:""}))})})}(jQuery);